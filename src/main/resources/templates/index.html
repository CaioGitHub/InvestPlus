<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Investimentos</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<div class="container">
    <div class="header">Investimentos</div>

    <div class="tabs">
        <a th:href="@{/investimentos/acoes}" th:classappend="${categoria} == 'acoes' ? 'active' : ''">Ações</a>
        <a th:href="@{/investimentos/fiis}" th:classappend="${categoria} == 'fiis' ? 'active' : ''">FIIs</a>
        <a th:href="@{/investimentos/favoritos}" th:classappend="${categoria} == 'favoritos' ? 'active' : ''">Meus Favoritos</a>
    </div>

    <!-- CONTROLS: Busca em uma linha; Ordenação em outra -->
    <div class="controls">
        <form id="searchSortForm" method="get"
              th:action="@{/investimentos/{categoria}(categoria=${categoria})}">
            <!-- primeira linha: busca -->
            <div class="search-row">
                <input class="codigo-input" type="text" name="codigo" placeholder="Pesquisar por código (ex: PETR4)"
                       th:value="${codigo != null ? codigo : ''}" />
                <button class="search-btn" type="submit">Buscar</button>
            </div>

            <!-- segunda linha: ordenação -->
            <div class="sort-row">
                <input type="hidden" name="page" id="pageInput" th:value="${page}"/>

                <label class="sort-label">Ordenar por:</label>
                <select name="sort" id="sortSelect" class="sort-select">
                    <option value="name" th:selected="${sort=='name'}">Nome</option>
                    <option value="close" th:selected="${sort=='close'}">Valor</option>
                </select>

                <select name="dir" id="dirSelect" class="dir-select">
                    <option value="asc" th:selected="${dir=='asc'}">Crescente</option>
                    <option value="desc" th:selected="${dir=='desc'}">Decrescente</option>
                </select>

                <button class="apply-btn" type="submit">Aplicar</button>
            </div>
        </form>
    </div>

    <section class="list-section">
        <div class="item" th:each="ativo : ${ativos}">
            <div style="display:flex; align-items:center;">
                <img th:if="${ativo.logo != null}" th:src="${ativo.logo}" alt="logo"
                     style="width:28px;height:28px;margin-right:8px;vertical-align:middle"/>
                <div>
                    <strong th:text="${ativo.stock}"></strong> -
                    <span th:text="${ativo.name}"></span> <br>
                    <span th:if="${ativo.close != null}">
                        Preço: <span th:text="${ativo.close}">0.00</span>
                    </span>
                </div>
            </div>
            <button
                    th:data-symbol="${ativo.stock}"
                    th:data-name="${ativo.name != null ? ativo.name : ''}"
                    th:data-category="${ativo.type != null ? ativo.type : categoria}"
                    th:text="${observadoSymbols.contains(ativo.stock) ? '-' : '+'}">
            </button>
        </div>
    </section>

    <div class="pager">
        <a th:classappend="${page <= 1} ? 'disabled' : ''"
           th:if="${page > 1}"
           th:href="@{/investimentos/{categoria}(categoria=${categoria},page=${page-1},sort=${sort},dir=${dir})}"> < </a>

        <span>Pagina <strong th:text="${page}">1</strong> de <strong th:text="${totalPages}">1</strong></span>

        <a th:classappend="${page >= totalPages} ? 'disabled' : ''"
           th:if="${page < totalPages}"
           th:href="@{/investimentos/{categoria}(categoria=${categoria},page=${page+1},sort=${sort},dir=${dir})}"> > </a>
    </div>
</div>

<script src="/js/scripts.js"></script>
</body>
</html>
