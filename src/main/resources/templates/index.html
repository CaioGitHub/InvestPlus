<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Investimentos</title>
    <style>
        body { margin: 0; height: 100vh; display:flex; justify-content:center; align-items:center; background:#f4f4f4; font-family: Arial, sans-serif; }
        .container { width:420px; height:600px; display:flex; flex-direction:column; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,.1); overflow:hidden; }
        .header { text-align:center; padding:15px; font-size:20px; font-weight:bold; border-bottom:1px solid #ddd; }
        .tabs { display:flex; justify-content:center; gap:15px; padding:10px; border-bottom:1px solid #ddd; }
        .tabs a { text-decoration:none; color:#333; font-size:14px; }
        .tabs a.active { font-weight:bold; color:#007bff; }
        .list-section { flex:1 1 auto; overflow-y:auto; padding:10px; }
        .item { display:flex; justify-content:space-between; align-items:center; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:6px; background:#fafafa; }
        .item strong { display:block; }
        .item button { background:none; border:1px solid #007bff; color:#007bff; padding:5px 10px; border-radius:6px; cursor:pointer; font-size:16px; }
        .item button:hover { background:#007bff; color:white; }
        .pager { display:flex; justify-content:center; gap:10px; padding:8px 0; border-top:1px solid #eee; }
        .pager .disabled { opacity:0.5; pointer-events:none; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">Investimentos</div>

    <div class="tabs">
        <a th:href="@{/investimentos/acoes}" th:classappend="${categoria} == 'acoes' ? 'active' : ''">Ações</a>
        <a th:href="@{/investimentos/fiis}" th:classappend="${categoria} == 'fiis' ? 'active' : ''">FIIs</a>
        <a th:href="@{/investimentos/favoritos}" th:classappend="${categoria} == 'favoritos' ? 'active' : ''">Meus Favoritos</a>
    </div>

    <section class="list-section">
        <div class="item" th:each="ativo : ${ativos}">
            <div>
                <img th:if="${ativo.logo != null}" th:src="${ativo.logo}" alt="logo"
                     style="width:28px;height:28px;margin-right:8px;vertical-align:middle"/>
                <strong th:text="${ativo.stock}"></strong> -
                <span th:text="${ativo.name}"></span> <br>
                <span th:if="${ativo.close != null}">
                    Preço: <span th:text="${ativo.close}">0.00</span>
                </span>
            </div>

            <button
                    th:data-symbol="${ativo.stock}"
                    th:data-name="${ativo.name != null ? ativo.name : ''}"
                    th:data-category="${ativo.type != null ? ativo.type : categoria}"
                    th:text="${observadoSymbols.contains(ativo.stock) ? '-' : '+'}">
            </button>
        </div>
    </section>

    <!-- Paginação -->
    <div class="pager">
        <a th:classappend="${page <= 1} ? 'disabled' : ''"
           th:if="${page > 1}"
           th:href="@{/investimentos/{categoria}(categoria=${categoria},page=${page-1})}">Anterior</a>

        <span>Pagina <strong th:text="${page}">1</strong> de <strong th:text="${totalPages}">1</strong></span>

        <a th:classappend="${page >= totalPages} ? 'disabled' : ''"
           th:if="${page < totalPages}"
           th:href="@{/investimentos/{categoria}(categoria=${categoria},page=${page+1})}">Próxima</a>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".item button").forEach(btn => {
            btn.addEventListener("click", async () => {
                const symbol = btn.getAttribute("data-symbol");
                const name = btn.getAttribute("data-name");
                const category = btn.getAttribute("data-category");

                try {
                    const res = await fetch("/investimentos/observados/toggle", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ symbol, name, category })
                    });
                    if (res.ok) {
                        // simples reload para refletir a mudança
                        window.location.reload();
                    } else {
                        alert("Erro no servidor ao atualizar favoritos");
                    }
                } catch (e) {
                    console.error(e);
                    alert("Erro na requisição");
                }
            });
        });
    });
</script>
</body>
</html>
